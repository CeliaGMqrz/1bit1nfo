<!DOCTYPE html>
<html lang="en" data-theme=""><head>
    <title> Celia García Márquez | Servidor Web Apache2 (httpd) en Centos8 </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.80.0" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="Celia García Márquez">
    
    <link rel="stylesheet"
          href="https://1bit1nfo.netlify.app/css/style.min.133432b892a2d2ebe6870bf5a4502dbc4f350a601ff3ab5e34829d6da9a6ca5e.css"
          integrity="sha256-EzQyuJKi0uvmhwv1pFAtvE81CmAf86teNIKdbammyl4="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://1bit1nfo.netlify.app/css/markupHighlight.min.4ac4c94828876abc926f5563ef81e319b441b25cad2c96842d2b87fd204a0de6.css"
        integrity="sha256-SsTJSCiHarySb1Vj74HjGbRBslytLJaELSuH/SBKDeY="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://1bit1nfo.netlify.app/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://1bit1nfo.netlify.app/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://1bit1nfo.netlify.app/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://1bit1nfo.netlify.app/favicons/favicon-16x16.png">

    <link rel="canonical" href="https://1bit1nfo.netlify.app/post/httpd_centos/">

    
    
    
    
    <script type="text/javascript"
            src="https://1bit1nfo.netlify.app/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            integrity="sha256-2Fme4Ht9PxG6&#43;6wwZXzMWR6Nf9Nqn1gM1MCeJODkqXE="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="https://1bit1nfo.netlify.app/js/anatole-theme-switcher.min.e289e9ebb2a4e7a7f895859c8a2b0da2de1ec73f22cea58d8475aa0597023837.js"
                integrity="sha256-4onp67Kk56f4lYWciisNot4exz8izqWNhHWqBZcCODc="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://1bit1nfo.netlify.app/images/avatar_red.jpg"/>

<meta name="twitter:title" content="Servidor Web Apache2 (httpd) en Centos8"/>
<meta name="twitter:description" content="Este artículo trata sobre la instalación de un servidor web Apache2 sobre Centos8 incluido dentro de un entorno previamente creado en un cloud."/>


    

</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="https://1bit1nfo.netlify.app/images/avatar_red.jpg" alt="profile picture">
            <h3 title=""><a href="/">Un bit de información cada día</a></h3>
            <div class="description">
                <p>Celia García Márquez</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/cgmarquez/" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/CeliaGMqrz" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:cg.marquez95@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Celia García Márquez  2020-2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Inicio</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">Sobre mí</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
            <div class="post-title">
                <h3>Servidor Web Apache2 (httpd) en Centos8</h3>
                
                    <div class="info">
                        <em class="fas fa-calendar-day"></em>
                        <span class="date"> Wed, Jan 13, 2021 
                                           </span>
                        <em class="fas fa-stopwatch"></em>
                        <span class="reading-time">5-minute read</span>
                    </div>
                
            </div>

            <p><img src="/images/dns/banner.jpg" alt="banner.jpg"></p>
<p>Este artículo trata sobre la instalación de un servidor web Apache2 sobre Centos8 incluido dentro de un entorno previamente creado en un cloud. Las entradas anteriores son las siguientes:</p>
<ul>
<li>
<p><a href="https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/instalaci%C3%B3n-y-configuraci%C3%B3n-inicial-de-los-servidores/">Instalación inicial de los servidores</a></p>
</li>
<li>
<p><a href="https://unbitdeinformacioncadadia.netlify.app/posts/2020/12/red-dmz.-modificacion-del-escenario./">Modificación del escenario</a></p>
</li>
<li>
<p><a href="https://unbitdeinformacioncadadia.netlify.app/posts/2020/11/actualizacion-de-centos7-a-centos8/">Actualización de Centos7 a Centos8</a></p>
</li>
</ul>
<h2 id="1-descripción-de-la-tarea">1. Descripción de la tarea:</h2>
<p>En quijote (CentOs)(Servidor que está en la DMZ) vamos a instalar un <strong>servidor web apache</strong>. Configura el servidor para que sea capaz de ejecutar código php (para ello vamos a usar un servidor de aplicaciones** php-fpm**). Entrega una captura de pantalla accediendo a <a href="http://www.tunombre.gonzalonazareno.org/info.php">www.tunombre.gonzalonazareno.org/info.php</a> donde se vea la salida del fichero info.php. Investiga la reglas DNAT de cortafuegos que tienes que configurar en dulcinea para, cuando accedemos a la IP flotante se acceda al servidor web.</p>
<h2 id="2-conceptos">2. Conceptos:</h2>
<p>Si quieres ver una introducción de Apache 2.4 <a href="https://github.com/CeliaGMqrz/virtualhosting_apache/blob/main/introduccion_apache.md">esta es tu página</a>, antes de proceder con esta guía. En este repositorio se dan los conceptos básicos y las ventajas de usar Apache2, así como su instalación en Debian/Ubuntu y además una guía para crear virtualhosting con el mismo.</p>
<h2 id="3-instalar-apache2">3. Instalar Apache2</h2>
<p>Apache se encuetra disponible en los repositorios de CentOS, lo vamos a instalar con dnf</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo dnf install httpd
</code></pre></div><p>Lo iniciamos y comprobamos que está funcionando</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>centos@quijote ~<span class="o">]</span>$ sudo systemctl start httpd
<span class="o">[</span>centos@quijote ~<span class="o">]</span>$ sudo systemctl status httpd
● httpd.service - The Apache HTTP Server
   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/httpd.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
   Active: active <span class="o">(</span>running<span class="o">)</span> since Tue 2021-01-12 17:21:47 CET<span class="p">;</span> 2s ago
     Docs: man:httpd.service<span class="o">(</span>8<span class="o">)</span>
 Main PID: <span class="m">38523</span> <span class="o">(</span>httpd<span class="o">)</span>
   Status: <span class="s2">&#34;Started, listening on: port 80&#34;</span>
    Tasks: <span class="m">213</span> <span class="o">(</span>limit: 2731<span class="o">)</span>
   Memory: 21.3M
   CGroup: /system.slice/httpd.service
           ├─38523 /usr/sbin/httpd -DFOREGROUND
           ├─38524 /usr/sbin/httpd -DFOREGROUND
           ├─38525 /usr/sbin/httpd -DFOREGROUND
           ├─38526 /usr/sbin/httpd -DFOREGROUND
           └─38527 /usr/sbin/httpd -DFOREGROUND

Jan <span class="m">12</span> 17:21:47 quijote systemd<span class="o">[</span>1<span class="o">]</span>: Starting The Apache HTTP Server...
</code></pre></div><h2 id="4-configurar-el-firewall">4. Configurar el firewall</h2>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo firewall-cmd --permanent --add-service<span class="o">=</span>https
sudo firewall-cmd --zone<span class="o">=</span>public --permanent --add-service<span class="o">=</span>http
sudo firewall-cmd --reload
</code></pre></div><h2 id="5-crear-virtualhost">5. Crear virtualhost</h2>
<p>Creamos los directorios &lsquo;sites-enabled&rsquo; y &lsquo;sites-avaliable&rsquo; y le indicamos que vamos a tener nuestros virtualhost en esas carpetas</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo mkdir /etc/httpd/sites-enabled
sudo mkdir /etc/httpd/sites-available
sudo nano /etc/httpd/conf/httpd.conf 
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo nano /etc/httpd/conf/httpd.conf 
</code></pre></div><p><code>/etc/httpd/conf/httpd.conf </code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">IncludeOptional sites-enabled/*.conf
</code></pre></div><p>Creamos el documentroot y el html principal</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo mkdir /var/www/iesgn
sudo nano /var/www/iesgn/index.html
</code></pre></div><p>Crearemos una carpeta para el log de manera que podamos ver los errores</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo mkdir /var/www/iesgn/log
</code></pre></div><p>Vemos los permisos que tiene el documenroot y nos aseguramos de que están correctos</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>centos@quijote ~<span class="o">]</span>$ ls -l /var/www/
total <span class="m">0</span>
drwxr-xr-x. <span class="m">2</span> root root  <span class="m">6</span> Nov  <span class="m">4</span> 04:23 cgi-bin
drwxr-xr-x. <span class="m">2</span> root root  <span class="m">6</span> Nov  <span class="m">4</span> 04:23 html
drwxr-xr-x. <span class="m">3</span> root root <span class="m">35</span> Jan <span class="m">13</span> 10:59 iesgn
</code></pre></div><p>Creamos el fichero de configuración de nuestro virtualhost</p>
<p><code>sudo nano /etc/httpd/sites-availble/celia.gonzalonazareno.conf</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"> &lt;VirtualHost *:80&gt;
    ServerName www.celia.gonzalonazareno.org
    DocumentRoot /var/www/iesgn     
    ErrorLog /var/www/iesgn/log/error.log
    CustomLog /var/www/iesgn/log/requests.log combined
&lt;/VirtualHost&gt;

</code></pre></div><p>Creamos el enlace y vemos que se ha creado correctamente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>centos@quijote ~<span class="o">]</span>$ sudo ln -s /etc/httpd/sites-available/celia.gonzalonazareno.org.conf /etc/httpd/sites-enabled/

<span class="o">[</span>centos@quijote ~<span class="o">]</span>$ cat /etc/httpd/sites-enabled/celia.gonzalonazareno.org.conf 
&lt;VirtualHost *:80&gt;
    ServerName www.celia.gonzalonazareno.org
    DocumentRoot /var/www/iesgn
    ErrorLog /var/www/iesgn/log/error.log
    CustomLog /var/www/iesgn/log/requests.log combined
&lt;/VirtualHost&gt;

</code></pre></div><p>Ejecutamos el siguiente comando para configurar una política universal de Apache:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo setsebool -P httpd_unified <span class="m">1</span>
</code></pre></div><p>Reiniciamos el servicio y comprobamos que está funcionando</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">lines 1-19/19 <span class="o">(</span>END<span class="o">)</span>...skipping...
● httpd.service - The Apache HTTP Server
   Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/httpd.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
   Active: active <span class="o">(</span>running<span class="o">)</span> since Wed 2021-01-13 11:17:18 CET<span class="p">;</span> 1min 12s ago
     Docs: man:httpd.service<span class="o">(</span>8<span class="o">)</span>
 Main PID: <span class="m">39646</span> <span class="o">(</span>httpd<span class="o">)</span>
   Status: <span class="s2">&#34;Running, listening on: port 80&#34;</span>
    Tasks: <span class="m">213</span> <span class="o">(</span>limit: 2731<span class="o">)</span>
   Memory: 21.3M
   CGroup: /system.slice/httpd.service
           ├─39646 /usr/sbin/httpd -DFOREGROUND
           ├─39647 /usr/sbin/httpd -DFOREGROUND
           ├─39648 /usr/sbin/httpd -DFOREGROUND
           ├─39649 /usr/sbin/httpd -DFOREGROUND
           └─39650 /usr/sbin/httpd -DFOREGROUND

Jan <span class="m">13</span> 11:17:17 quijote systemd<span class="o">[</span>1<span class="o">]</span>: Starting The Apache HTTP Server...
Jan <span class="m">13</span> 11:17:18 quijote httpd<span class="o">[</span>39646<span class="o">]</span>: AH00558: httpd: Could not reliably determine the server<span class="err">&#39;</span>s fully qu&gt;
Jan <span class="m">13</span> 11:17:18 quijote systemd<span class="o">[</span>1<span class="o">]</span>: Started The Apache HTTP Server.
Jan <span class="m">13</span> 11:17:18 quijote httpd<span class="o">[</span>39646<span class="o">]</span>: Server configured, listening on: port <span class="m">80</span>

</code></pre></div><p>Ahora tenemos que ir a Dulcinea y agregar una regla DNAT con iptables para redirigir el trafico y se pueda acceder a la web por el puerto 80</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">debian@dulcinea:~$ sudo iptables -t nat -A PREROUTING -p tcp --dport <span class="m">80</span> -i eth0 -j DNAT --to 10.0.2.4:80

debian@dulcinea:~$ sudo iptables -t nat -L -nv
Chain PREROUTING <span class="o">(</span>policy ACCEPT <span class="m">0</span> packets, <span class="m">0</span> bytes<span class="o">)</span>
 pkts bytes target     prot opt in     out     <span class="nb">source</span>               destination         
   <span class="m">23</span>  <span class="m">2314</span> DNAT       udp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            udp dpt:53 to:10.0.1.2:53
    <span class="m">0</span>     <span class="m">0</span> DNAT       tcp  --  eth0   *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80 to:10.0.2.4:80

Chain INPUT <span class="o">(</span>policy ACCEPT <span class="m">0</span> packets, <span class="m">0</span> bytes<span class="o">)</span>
 pkts bytes target     prot opt in     out     <span class="nb">source</span>               destination         

Chain POSTROUTING <span class="o">(</span>policy ACCEPT <span class="m">0</span> packets, <span class="m">0</span> bytes<span class="o">)</span>
 pkts bytes target     prot opt in     out     <span class="nb">source</span>               destination         
 <span class="m">2122</span>  163K MASQUERADE  all  --  *      eth0    10.0.1.0/24          0.0.0.0/0           
  <span class="m">679</span> <span class="m">48548</span> MASQUERADE  all  --  *      eth0    10.0.2.0/24          0.0.0.0/0           

Chain OUTPUT <span class="o">(</span>policy ACCEPT <span class="m">0</span> packets, <span class="m">0</span> bytes<span class="o">)</span>
 pkts bytes target     prot opt in     out     <span class="nb">source</span>               destination  
</code></pre></div><p>Nos aseguramos que en nuestra máquina física tenemos en el /etc/resolv.conf el servidor dns con la ip de dulcinea y la dirección del sitio web asociada la ip de dulcinea en el /etc/hosts, ya que no estamos conectando desde casa.</p>
<p>Comprobamos que podemos acceder a la web</p>
<p><img src="/images/dns/web.jpeg" alt="web.jpeg"></p>
<h3 id="instalación-de-php-fpm">Instalación de php-fpm</h3>
<p>Para ello debemos ejecutar lo siguiente</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo dnf install php php-fpm  php-gd php-mysqlnd
</code></pre></div><p>Habilitamos e iniciamos el servicio</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="o">[</span>centos@quijote ~<span class="o">]</span>$ sudo systemctl <span class="nb">enable</span> php-fpm
Created symlink /etc/systemd/system/multi-user.target.wants/php-fpm.service → /usr/lib/systemd/system/php-fpm.service.
<span class="o">[</span>centos@quijote ~<span class="o">]</span>$ sudo systemctl start php-fpm
</code></pre></div><p>Ahora tenemos que editar el fichero de configuración de nuestro virtualhost para poder servir php, le agregamos lo siguiente:</p>
<p><code>/etc/httpd/sites-available/celia.gonzalonazareno.org.conf</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">&lt;Proxy <span class="s2">&#34;unix:/run/php-fpm/www.sock|fcgi://php-fpm&#34;</span>&gt;
        ProxySet <span class="nv">disablereuse</span><span class="o">=</span>off
&lt;/Proxy&gt;

&lt;FilesMatch <span class="se">\.</span>php$&gt;
        SetHandler proxy:fcgi://php-fpm
&lt;/FilesMatch&gt;
</code></pre></div><p>Una vez modificado el archivo tenemos que crear un fichero .php indispensable para ver que funciona</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">sudo nano /var/www/iesgn/info.php
</code></pre></div><p><code>info.php</code></p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">&lt;?php phpinfo<span class="o">()</span><span class="p">;</span> ?&gt;
</code></pre></div><p>Comprobamos que funciona</p>
<p><img src="/images/dns/info.png" alt="info.png"></p>
</div>
        <div class="post-footer">
            <div class="info">
                
                <span class="separator"><a class="tag" href="/tags/httpd/">httpd</a><a class="tag" href="/tags/apache/">apache</a><a class="tag" href="/tags/centos8/">centos8</a></span>

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://1bit1nfo.netlify.app/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script></body>

</html>
